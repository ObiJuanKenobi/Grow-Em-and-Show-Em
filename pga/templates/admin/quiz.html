{% include "admin/header.html" %}

<style>
	.correct {
		color: green;
	}
	
	.questionTextEdit, .answerEdit, .correctOption {
		display:none;
	}
</style>

<script type='text/javascript'>

	var editing = false;
	
	$(function() {
		
		$("#editBtn").click(function() {
		
			$(".questionText").toggle();
			$(".questionTextEdit").toggle();
			$(".answerEdit").toggle();
			$(".answer").toggle();
			$(".correctOption").toggle();
			
			editing = !editing;
			
			if(editing){
				$("#editBtn").text('Save');
			}
			else {
				$("#editBtn").text('Edit');
				
				//Save was pressed, find text that changed and update DB
				$("#questionsDiv div").each(function() {
					var id = $(this).attr('id');
					var originalText = $(this).find(".questionText").text().trim();
					var editedText = String($(this).find(".questionTextEdit").val()).trim();
					
					if(originalText !== editedText){
						alert("New question: " + editedText + ", " + originalText + ", " + id);
					}
					
					$(this).find("ol li").each(function() {
						var originalAnswer = $(this).find(".answer").text().trim();
						var editedAnswer = String($(this).find(".answerEdit").val()).trim();
						
						if(originalAnswer !== editedAnswer){
							alert("New answer: " + editedAnswer);
						}
						
						
					});
				});
			}
		});
		
	});
</script>

<span class='adminPageTitle'>{{ unit }} Quiz</span>&nbsp; &nbsp;<a class='backLink' href='/pgaadmin/unit/{{unit}}'>Back</a><br><br>

<div class='content'>
	<button id='editBtn'>Edit</button>&nbsp;
	<button id='addBtn'>Add Question</button>&nbsp;
	<button id='uploadListBtn'>Upload New Question List</button><br><br>
	
	<div id='questionsDiv'>
	{% for q in questions %}
		
		<div class='questionDiv' id='{{ q.id }}'>
		<b>Question {{ forloop.counter }} </b> <span class='questionText'>{{ q.question }}</span>
			<input type='text' class='questionTextEdit' value='{{ q.question }}'><br>
		
		<ol type='a' class='q{{q.id}}'>
		{% for a in q.answers %}
			
			
			{% if a.correct %}
				<li>
					<span class='option{{ forloop.counter }} answer correct'>{{a.answer}}</span>
					<input class='option{{ forloop.counter }} answerEdit' type='text' value='{{a.answer}}'> 
					<label class='correctOption'><input type='radio' class='correctOption' name='correct{{q.id}}' value='{{a.answer}}' checked>Correct Answer</label>
				</li>
			{% else %}
				<li><span class='option{{ forloop.counter }} answer'>{{a.answer}}</span>
					<input class='option{{ forloop.counter }} answerEdit' type='text' value='{{a.answer}}'>  
					<label class='correctOption'><input type='radio' class='correctOption' name='correct{{q.id}}' value='{{a.answer}}'>Correct Answer</label>
				</li>
			{% endif %}
			
		{% endfor %}
		</ol>
		</div>
		<br><br>
	{% endfor %}
	</div>
	
</div>

{% include "admin/footer.html" %}